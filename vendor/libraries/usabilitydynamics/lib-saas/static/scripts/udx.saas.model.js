"undefined"!=typeof ko?(ko=jQuery.extend(!0,{log:"undefined"!=typeof wpp&&"function"===wpp.log?wpp.log:function(){return!1},ajaxurl:function(a){return"undefined"!=typeof ajaxurl?ajaxurl+"?action=wpp_"+a:!1},strings:"undefined"!=typeof wpp&&"undefined"!==wpp.strings?wpp.strings:{}},ko),ko.view_model=function(a){"use strict";ko.log("ko.view_model()",arguments),a=jQuery.extend(!0,{model:{},args:{},instance:{},bind:!0,timeout:3e3,container:!1,saas:{scope:jQuery.extend("object"==typeof wpp.saas?wpp.saas:{},{scope:"wpp.saas"}),model:!1,screen:!1,show_updates:!1,debug_mode:!1,force_new_connection:!1,secure:!0,path:"_saas",instance:"object"==typeof wpp._instance?wpp._instance:{}},actions:{pre_apply:function(){},init:function(){},add_data:function(){},remove_data:function(){},get_model:function(){},timeout:!1,callback:!1,saas_connect:function(){},saas_disconnect:function(){},saas_set_screen:function(){},saas_update_on:function(){},saas_update_emit:function(){},saas_ignored:function(){}},callback:function(a,b){var c=this;return"object"==typeof c.actions&&"function"==typeof c.actions.callback?c.actions.callback(a,b):(a instanceof Error&&ko.log(a,b),b)}},"object"==typeof a?a:"string"==typeof a?{model:a}:{});var b=a.container&&"object"!=typeof a.container?jQuery(a.container):a.container;if(!b||"undefined"==typeof b.length||!b.length>0)return a.callback(new Error("ko.view_model. Container is missing, or incorrect."),!1);a.actions.timeout&&"function"==typeof a.actions.timeout||(a.actions.timeout=function(b){if("string"!=typeof b.saas.model||0!=b.saas.connected||0!=b.saas.ignore)return b._is_timeout=!0,a.callback(new Error("Timeout. View Model load error."));try{"object"==typeof b.saas.scope&&b.saas.scope.disconnect()}catch(c){console.log(c)}b._bind=b._args.bind,b.saas.ignore=!0,"object"==typeof b[b.saas.path]&&(b[b.saas.path]=ko.mapping.fromJS(b[b.saas.path])),b.apply(),b.saas.show_updates&&b.navbar_notice("SaaS offline");try{b._args.actions.saas_ignored(b)}catch(c){b._args.callback(c,b)}});var c=b.html();b.html("").addClass("ud_view_model ud_ui_loading").append('<div class="ud_ui_spinner"></div>').append('<div class="ud_ui_prepared_interface"></div>').find(".ud_ui_prepared_interface").html(c);var d=function(a,b){var c=this;if(c._applied=!1,c._loaded=!1,c.saas=a.saas,c._args=a,c.container=b,c._actions={},c._bind=a.bind,c._is_timeout=!1,c.timers={load_timeout:!1,socket_status:!1},c.add_data=function(a,b,d,e){"function"==typeof b?a.push(new b):"function"==typeof d[b]&&a.push(new d[b]);try{c._args.actions.add_data(c,e,a,b)}catch(f){c._args.callback(f,d)}},c.remove_data=function(a,b,d){var e="undefined"!=typeof ko.strings&&"undefined"!=typeof ko.strings.remove_confirmation?ko.strings.remove_confirmation:"Are you sure you want to remove it?";confirm(e)&&a.remove(b);try{c._args.actions.remove_data(c,d,a,b)}catch(f){c._args.callback(f,c)}},c.in_array=function(a,b){return b instanceof Array&&-1!=b.indexOf(a)},c.navbar_notice=function(a){var b=this;if(a="string"==typeof a?{message:a}:"object"==typeof a?a:{},"undefined"!=typeof a.message){var c=jQuery("li#ud_saas_message"),d=jQuery("li#ud_saas_object");return!c.length>0&&jQuery("ul#wp-admin-bar-root-default.ab-top-menu").append(c=jQuery('<li id="ud_saas_message" class="ud_saas_message"></li>')),a.object&&(!d.length>0&&jQuery("ul#wp-admin-bar-root-default.ab-top-menu").append(d=jQuery('<li id="ud_saas_object" class="ud_saas_object">[object]</li>')),jQuery(d).unbind("click"),jQuery(d).bind("click",function(){ud.admin.pointer(d,{pointerClass:"wp-pointer ud-pointer ud-saas-debug",title:a.message,pointerWidth:600,content:"<pre>"+JSON.stringify(a.object,void 0,2)+"</pre>"})})),c.fadeTo(500,1,function(){window.clearTimeout(b.timers.socket_status),c.html(a.message?a.message:""),b.timers.socket_status=window.setTimeout(function(){c.fadeTo(3e3,.5,function(){window.setTimeout(function(){c.fadeTo(3e3,.1)},5e3)})},a.fade_out?a.fade_out:1e4)}),a.message}},c.apply=function(){var a=this;if(a._is_timeout)return!1;if(!a._bind)return a._args.callback(null,a);if(this._applied)return a._args.callback(null,a);if(!a._loaded){var b=ko.strings.ko_model_failed;return a._args.callback(new Error(b),a)}try{try{a._args.actions.pre_apply(a)}catch(c){a._args.callback(c,a)}ko.applyBindings(a,a.container.get(0)),a._applied=!0,a.container.removeClass("ud_ui_loading").addClass("ud_ui_applied"),clearTimeout(a.timers.load_timeout);try{a._args.actions.init(a)}catch(c){console.log(c),a._args.callback(c,a)}return a._args.callback(null,a)}catch(b){return a._args.callback(b,a)}},c._prepare_model_data=function(a,b){var c=this,d={};a="object"!=typeof a?{}:a,b="object"!=typeof b?c:b;for(var e in a)switch(e){case"_static":for(var f in a[e])d[f]=b&&"function"==typeof b[f]?b[f](a[e][f]):a[e][f];break;case"_observable":for(var f in a[e])d[f]=b&&"function"==typeof b[f]?b[f](a[e][f]):a[e][f]&&"undefined"!=typeof a[e][f].length?"object"==typeof a[e][f]?ko.observableArray(a[e][f]):ko.observable(a[e][f]):ko.observable(a[e][f]);break;case"_action":c._actions=jQuery.extend(!0,c._actions,a[e]);break;case"_saas":if("string"==typeof c.saas.path){d[c.saas.path]={};for(var f in a[e])switch(f){case"conditionals":d[c.saas.path]=jQuery.extend(!0,{},d[c.saas.path],a[e][f]);break;case"interface":default:d[c.saas.path]=jQuery.extend(!0,{},a[e][f],d[c.saas.path])}"object"==typeof ud.utils&&"function"==typeof ud.utils.type_fix&&(d[c.saas.path]=ud.utils.type_fix(d[c.saas.path],{nullify:!0})),b&&"function"==typeof b[c.saas.path]&&(d[c.saas.path]=b[c.saas.path](d[c.saas.path]))}break;default:d[e]=b&&"function"==typeof b[e]?b[e](a[e]):"object"==typeof a[e]&&"undefined"==typeof a[e].length?c._prepare_model_data(a[e],"object"==typeof b[e]?b[e]:!1):a[e]}return d},c.timers.load_timeout=setTimeout(function(){a.actions.timeout(c)},a.timeout),c=jQuery.extend(!0,c,"object"==typeof c._args.instance?c._args.instance:{}),"string"==typeof c._args.model?(c._args.model_name=c._args.model,jQuery.ajax({url:ko.ajaxurl("get_model"),data:{args:jQuery.extend(!0,{},{model:c._args.model_name},c._args.args)},dataType:"json",type:"POST",async:!1,beforeSend:function(a){try{c._args.actions.get_model(c)}catch(b){c._args.callback(b,c)}a.overrideMimeType("application/json; charset=utf-8")},complete:function(a){var b={};try{if(b=jQuery.parseJSON(a.responseText),"object"!=typeof b||""===a.responseText)throw new Error("Ajax response is empty");if(500===a.status)throw new Error("Internal Server Error");if("timeout"===a.statusText)throw new Error("Server Timeout");if(1==typeof b.success)throw new Error("Could not get '"+c._args.model+"' model")}catch(d){ko.log("AJAX Error: "+(d.message?d.message:"Unknown.")),c._args.model=b=!1}b&&(c._args.model=b.model,c._args.model._name=c._args.model_name)},error:function(){}})):"undefined"==typeof c._args.model._name&&(c._args.model._name=""),c._args.model){c._loaded=!0;var d=c._prepare_model_data(c._args.model);d.strings=jQuery.extend(!0,ko.strings,"undefined"!=typeof d.strings?d.strings:{}),c=jQuery.extend(!0,c,d);for(var e in c._actions)if(jQuery('[data-action_hook="'+e+'"]',b).length>0)for(var f in c._actions[e])"string"==typeof c._actions[e][f]&&jQuery('[data-action_hook="'+e+'"]',b).append(c._actions[e][f]);if(c.saas._set_screen=function(a){if(ko.log("ko.view_model.vm()._saas_screen_set()",arguments),!c.saas.ignore){c.saas.connected=!0,"object"==typeof c[c.saas.path]&&(c.saas._active(!0),c.saas.update_trigger=c.saas.id+"::update::"+c.saas.screen,c.saas.scope.on(c.saas.id+"::request::_interface",function(){ko.log("ko.view_model.vm()._saas_screen_set(); Interface request received, responding."),c.saas._merging(!0),c.saas.scope.emit(c.saas.id+"::update::"+c.saas.screen,{key:c.saas.path,value:ko.toJS(c[c.saas.path])}),c.saas._merging(!1)}),c.saas.scope.on(c.saas.update_trigger,function(a){var a=jQuery.extend({path:!1,key:!1,value:!1,update:!0,message:!1},a),b=a.path&&a.key?a.path+"."+a.key:!1;if(c.saas._merging(!0),a.update&&b!==!1)try{c.saas._observable_caller[b].value(a.value)}catch(d){c._args.callback(new Error("Interface Path Not Found"),c)}"string"==typeof a.message&&a.message.length>0&&c.saas.show_updates&&c.navbar_notice(a.message);try{c._args.actions.saas_update_on(c,a)}catch(d){c._args.callback(d,c)}c.saas._merging(!1)}),jQuery(document).bind(c.saas.id+"::disconnected",function(){c.saas._active(!1)}),c[c.saas.path]=c.saas._set_emit(c[c.saas.path]));try{c._args.actions.saas_set_screen(c)}catch(a){c._args.callback(a,c)}c._bind=c._args.bind,c.apply()}},c.saas._set_emit=function(a,b){var d=function(a,b,d){c.saas._observable_caller[d+"."+b]={path:d,key:b,value:a},a.subscribe(function(a){if(!c.saas._merging())try{var e={key:b,value:a,path:d};c._args.actions.saas_update_emit(c,e),c.saas.scope.emit(c.saas.update_trigger,e)}catch(f){c._args.callback(f,c)}},c)},e=function(a,b){for(var c in a)"__ko_mapping__"!==c&&(ko.isObservable(a[c])?d(a[c],c,b):"object"==typeof a[c]&&e(a[c],b+"."+c))};return a=ko.mapping.fromJS(a),e(a,"string"==typeof b?b:c.saas.path),a},"function"==typeof c[c.saas.path]&&(c[c.saas.path]=c[c.saas.path]({})),"string"==typeof c.saas.model){if("function"!=typeof c.saas.scope.connect)return c._bind=!1,c._args.callback(new Error("undefined"!=typeof ko.strings.saas_connection_fail?ko.strings.saas_connection_fail:"Application could not connect to SaaS."),c);c.saas.scope.show_updates=c.saas.show_updates,"undefined"!=typeof c.saas.scope.settings.log&&(c.saas.debug_mode?jQuery.extend(c.saas.scope.settings.log,{events:!0,all_data:!0}):jQuery.extend(c.saas.scope.settings.log,{events:!1,all_data:!1})),c.saas.scope.instance=jQuery.extend({api_key:!1,site_uid:!1,customer_key:!1,customer_name:!1,site_url:!1,home:!1,ajax:!1,ip:!1,site:!1,screen:!1},c.saas.scope.instance,"object"==typeof c.saas.instance?c.saas.instance:{}),jQuery.extend(c.saas,{id:!1,update_trigger:!1,_merging:ko.observable(!1),_active:ko.observable(null),_observable_caller:{},connected:!1,ignore:!1}),"string"==typeof c.saas.screen&&(c._bind=!1,c.saas.scope.id&&!c.saas.force_new_connection?(c.saas.id=c.saas.scope.id,jQuery(document).one(c.saas.scope.id+"::update::screen_set::"+c.saas.screen,c.saas._set_screen)):jQuery(document).one("ud::saas::connect",function(a,b){c.saas.id=b.id,jQuery(document).one(b.id+"::update::screen_set::"+c.saas.screen,c.saas._set_screen);try{c._args.actions.saas_connect(c)}catch(d){c._args.callback(d,c)}jQuery(document).bind(b.id+"::update",function(a,b){c.saas.show_updates&&c.navbar_notice(b)}),jQuery(document).one(b.id+"::init",function(){c.saas.show_updates&&c.navbar_notice({message:ko.strings.connection_established?ko.strings.connection_established:"SaaS Online."})}),jQuery(document).one(b.id+"::disconnected",function(){c.saas.show_updates&&c.navbar_notice({message:ko.strings.connection_lost?ko.strings.connection_lost:"SaaS Offline."});try{c._args.actions.saas_disconnect(c)}catch(a){c._args.callback(a,c)}})}),c.saas.scope.instance.screen=c.saas.screen),c.saas.scope.connect(c.saas.model,{"force new connection":c.saas.force_new_connection,secure:c.saas.secure})}else"object"==typeof c[c.saas.path]&&(c[c.saas.path]=ko.mapping.fromJS(c[c.saas.path]))}};return d=new d(a,b),ko.log(d),d.apply()}):ko={view_model:function(){return!1}};